var e=Object.defineProperty,t=(t,a,n)=>((t,a,n)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n)(t,"symbol"!=typeof a?a+"":a,n);import{G as a}from"./vue-vendor--Sor-fzI.js";const n=class e{constructor(){t(this,"animations",new Map)}static getInstance(){return e.instance||(e.instance=new e),e.instance}async movePlayer(e,t,a,n=500){var i;const o="player-".concat(e.id),s=document.querySelector('[data-player-id="'.concat(e.id,'"]'));if(!s)return;null==(i=this.animations.get(o))||i.cancel(),s.classList.add("player-token-moving");const r=s.animate([{transform:"scale(1) translateY(0)"},{transform:"scale(1.2) translateY(-30px)"},{transform:"scale(1) translateY(0)"}],{duration:n,easing:"cubic-bezier(0.68, -0.55, 0.265, 1.55)"});return this.animations.set(o,r),new Promise((e=>{r.onfinish=()=>{s.classList.remove("player-token-moving"),this.animations.delete(o),e(!0)}}))}async showMoneyEffect(e,t,a){const n=document.createElement("div");n.className="money-effect",n.textContent=e>0?"+$".concat(e):"-$".concat(Math.abs(e)),n.style.cssText="\n      position: fixed;\n      left: ".concat(t,"px;\n      top: ").concat(a,"px;\n      font-size: 24px;\n      font-weight: bold;\n      color: ").concat(e>0?"#00A870":"#FF6B6B",";\n      pointer-events: none;\n      z-index: 1000;\n      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n    "),document.body.appendChild(n);const i=n.animate([{transform:"translateY(0) scale(1)",opacity:1},{transform:"translateY(-50px) scale(1.2)",opacity:.8},{transform:"translateY(-100px) scale(1)",opacity:0}],{duration:1e3,easing:"cubic-bezier(0.4, 0, 0.2, 1)"});await i.finished,n.remove()}async showParticles(e,t,a){const n={money:["#00A870","#00D68F"],birthday:["#FF8FB1","#FFC2D4"],chance:["#7C5CFF","#9E85FF"]},i=Array.from({length:20},(()=>{const i=document.createElement("div");i.className="particle ".concat(a);const o=4+4*Math.random();return i.style.cssText="\n        position: fixed;\n        left: ".concat(e,"px;\n        top: ").concat(t,"px;\n        width: ").concat(o,"px;\n        height: ").concat(o,"px;\n        background: ").concat(n[a][Math.floor(2*Math.random())],";\n        border-radius: 50%;\n        pointer-events: none;\n        z-index: 1000;\n      "),document.body.appendChild(i),i})),o=i.map(((e,t)=>{const a=t/i.length*Math.PI*2,n=100+50*Math.random(),o=1e3+500*Math.random();return e.animate([{transform:"translate(0, 0) scale(1) rotate(0deg)",opacity:1},{transform:"translate(".concat(Math.cos(a)*n,"px, ").concat(Math.sin(a)*n,"px) scale(0) rotate(").concat(360+360*Math.random(),"deg)"),opacity:0}],{duration:o,easing:"cubic-bezier(0.4, 0, 0.2, 1)"})}));await Promise.all(o.map((e=>e.finished))),i.forEach((e=>e.remove()))}async showGlowEffect(e,t){const a=document.createElement("div");a.style.cssText="\n      position: absolute;\n      inset: 0;\n      border-radius: inherit;\n      background: radial-gradient(circle at center, ".concat(t,"40 0%, transparent 70%);\n      pointer-events: none;\n      opacity: 0;\n    "),e.appendChild(a);const n=a.animate([{opacity:0,transform:"scale(0.8)"},{opacity:1,transform:"scale(1.2)"},{opacity:0,transform:"scale(1.5)"}],{duration:800,easing:"ease-out"});await n.finished,a.remove()}};t(n,"instance");const i=n.getInstance();const o=new class{constructor(){t(this,"sounds",{}),t(this,"bgm",null),t(this,"enabled",!0),t(this,"bgmEnabled",!0),this.initSounds(),this.initBGM()}initSounds(){Object.entries({roll:"./sounds/roll.mp3",move:"./sounds/move.mp3",buy:"./sounds/buy.mp3",money:"./sounds/money.mp3",chance:"./sounds/chance.mp3",birthday:"./sounds/birthday.mp3",tax:"./sounds/tax.mp3",win:"./sounds/win.mp3",lose:"./sounds/lose.mp3",click:"./sounds/click.mp3"}).forEach((([e,t])=>{const a=new Audio(t);a.preload="auto",this.sounds[e]=a}))}initBGM(){this.bgm=new Audio("/sounds/bgm.mp3"),this.bgm.loop=!0,this.bgm.volume=.3}play(e){if(!this.enabled)return;const t=this.sounds[e];t&&(t.currentTime=0,t.play().catch((()=>{})))}playBGM(){this.bgmEnabled&&this.bgm&&this.bgm.play().catch((()=>{}))}pauseBGM(){this.bgm&&this.bgm.pause()}toggleBGM(){return this.bgm&&(this.bgm.paused?(this.bgmEnabled=!0,this.bgm.play().catch((()=>{}))):(this.bgmEnabled=!1,this.bgm.pause())),this.bgmEnabled}toggle(){return this.enabled=!this.enabled,this.enabled}setEnabled(e){this.enabled=e}setBGMEnabled(e){this.bgmEnabled=e,e?this.playBGM():this.pauseBGM()}stop(e){const t=this.sounds[e];t&&(t.pause(),t.currentTime=0)}},s=a("game",{state:()=>{const e=localStorage.getItem("gameSettings"),t={players:[],currentPlayer:0,cells:[{id:0,type:"start",name:"起点",effect:"经过或停留获得2000"},{id:1,type:"property",name:"东大街",price:1e3},{id:2,type:"chance",name:"机会",effect:"抽取机会卡片"},{id:3,type:"property",name:"西大街",price:1500},{id:4,type:"birthday",name:"生日惊喜",effect:"获得礼金1000"},{id:5,type:"property",name:"南大街",price:2e3},{id:6,type:"tax",name:"所得税",effect:"支付税金500"},{id:7,type:"property",name:"北大街",price:2500},{id:8,type:"chance",name:"机会",effect:"抽取机会卡片"},{id:9,type:"property",name:"和平路",price:3e3},{id:10,type:"birthday",name:"蛋糕店",effect:"获得生日蛋糕"},{id:11,type:"property",name:"青年路",price:3500},{id:12,type:"chance",name:"机会",effect:"抽取机会卡片"},{id:13,type:"property",name:"解放路",price:4e3},{id:14,type:"tax",name:"物业费",effect:"支付物业费800"},{id:15,type:"property",name:"中山路",price:4500},{id:16,type:"property",name:"人民路",price:5e3},{id:17,type:"chance",name:"机会",effect:"抽取机会卡片"},{id:18,type:"property",name:"文化街",price:5500},{id:19,type:"birthday",name:"礼品店",effect:"获得生日礼物"},{id:20,type:"property",name:"科技路",price:6e3},{id:21,type:"tax",name:"维修费",effect:"支付维修费1200"},{id:22,type:"property",name:"商业街",price:6500},{id:23,type:"property",name:"金融街",price:7e3},{id:24,type:"chance",name:"机会",effect:"抽取机会卡片"},{id:25,type:"property",name:"未来路",price:7500},{id:26,type:"birthday",name:"派对屋",effect:"举办生日派对"},{id:27,type:"property",name:"创新路",price:8e3},{id:28,type:"tax",name:"豪华税",effect:"支付豪华税1500"},{id:29,type:"property",name:"成功路",price:8500},{id:30,type:"chance",name:"机会",effect:"抽取机会卡片"},{id:31,type:"property",name:"财富路",price:9e3}],isGameStarted:!1,showDialog:!1,dialogContent:null,isGameOver:!1,winner:null,settings:{initialMoney:1e4,startBonus:2e3,cellCounts:{start:1,property:16,chance:6,birthday:4,tax:4},propertyMinPrice:1e3,propertyMaxPrice:9e3,taxAmount:500,birthdayBonus:1e3,chanceCards:[{effect:"获得酸奶一瓶",amount:0,type:"success",probability:10,oneTime:!0},{effect:"获得泡面一包",amount:0,type:"success",probability:10,oneTime:!0},{effect:"获得面包丁一包",amount:0,type:"success",probability:10,oneTime:!0},{effect:"获得瑞士卷一个",amount:0,type:"success",probability:10,oneTime:!0},{effect:"得大疆手机云台",amount:0,type:"success",probability:10,oneTime:!0},{effect:"中了彩票",amount:2e3,type:"success",probability:10},{effect:"手机维修",amount:-500,type:"warning",probability:10},{effect:"收到红包",amount:800,type:"success",probability:10},{effect:"请客吃饭",amount:-1e3,type:"warning",probability:10},{effect:"股票收益",amount:1500,type:"success",probability:10}],playerNames:["玩家1","玩家2","玩家3","玩家4"]},isMoving:!1};return e&&(t.settings=JSON.parse(e)),t},actions:{initGame(e,t=1e4){this.players=Array.from({length:e},((e,a)=>({id:a,name:this.settings.playerNames[a],position:0,money:t,color:["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4"][a]}))),this.isGameStarted=!0,this.isGameOver=!1,this.winner=null,this.currentPlayer=0,this.cells.forEach((e=>{"property"===e.type&&delete e.owner})),this.settings.chanceCards.forEach((e=>{e.used=!1})),o.playBGM()},async movePlayer(e){this.isMoving=!0;const t=this.players[this.currentPlayer],a=t.position;this.cells.length;const n=setInterval((()=>{o.play("roll")}),150);await new Promise((e=>setTimeout(e,800))),clearInterval(n);const s=[];let r=a;for(let i=1;i<=e;i++){let e;e=r<8?r+1:8===r?9:r>=9&&r<15?r+1:15===r?16:r>=16&&r<24?r+1:24===r?25:r>=25&&r<31?r+1:0,s.push(e),r=e}for(let c=0;c<s.length;c++){const e=s[c];if(t.position=e,o.play("move"),await new Promise((e=>setTimeout(e,500))),0===e&&31!==a){await new Promise((e=>setTimeout(e,300))),t.money+=2e3;const e=document.querySelector('[data-player-id="'.concat(t.id,'"]'));if(e){const t=e.getBoundingClientRect();await i.showMoneyEffect(2e3,t.left,t.top),await i.showParticles(t.left+t.width/2,t.top+t.height/2,"money")}o.play("money"),this.showMessage("经过起点","获得奖励 $2000！","success")}}await new Promise((e=>setTimeout(e,300))),await this.handleCellEffect(t),this.isMoving=!1,this.nextPlayer()},async handleCellEffect(e){var t,a;const n=this.cells[e.position];if(!n)return;const s=document.querySelector('[data-player-id="'.concat(e.id,'"]')),r=null==s?void 0:s.getBoundingClientRect();switch(n.type){case"birthday":e.money+=1e3,o.play("birthday"),r&&(await i.showMoneyEffect(1e3,r.left,r.top),await i.showParticles(r.left+r.width/2,r.top+r.height/2,"birthday")),this.showMessage("生日快乐！","获得礼金 $1000！","success");break;case"tax":const s=Number(null==(a=null==(t=n.effect)?void 0:t.match(/\d+/))?void 0:a[0])||500;e.money-=s,r&&await i.showMoneyEffect(-s,r.left,r.top),o.play("tax"),this.showMessage("缴纳税金","支付税金 $".concat(s),"warning");break;case"property":if(void 0===n.owner&&e.money>=(n.price||0))await new Promise((t=>{this.dialogContent={title:"购买房产",message:"是否购买 ".concat(n.name,"？价格：$").concat(n.price),type:"info",action:()=>{this.buyProperty(n,e),this.closeDialog(),t()}},this.showDialog=!0;const a=this.closeDialog;this.closeDialog=()=>{a(),t()}}));else if(void 0!==n.owner&&n.owner!==e.id){const t=Math.floor(.3*(n.price||0)),a=1+.1*(this.cells.filter((e=>"property"===e.type&&e.owner===n.owner)).length-1),i=Math.floor(t*a);this.showMessage("支付租金","需要支付租金 $".concat(i,"\n(基础租金：$").concat(t," × ").concat(a.toFixed(1),"倍)"),"warning"),await new Promise((e=>setTimeout(e,1500))),await this.payRent(e,n.owner,i)}break;case"chance":r&&await i.showParticles(r.left+r.width/2,r.top+r.height/2,"chance"),this.drawChanceCard(e)}await this.checkGameOver()},buyProperty(e,t){if(t.money>=(e.price||0)){t.money-=e.price||0,e.owner=t.id,o.play("buy");const a=document.querySelector('[data-player-id="'.concat(t.id,'"]'));if(a){const t=a.getBoundingClientRect();i.showMoneyEffect(-(e.price||0),t.left,t.top)}this.showMessage("购买成功","你现在是 ".concat(e.name," 的主人了！"),"success")}},async payRent(e,t,a){e.money-=a;const n=this.players.find((e=>e.id===t));if(n){n.money+=a;const s=document.querySelector('[data-player-id="'.concat(e.id,'"]'));if(s){const e=s.getBoundingClientRect();await i.showMoneyEffect(-a,e.left,e.top)}const r=document.querySelector('[data-player-id="'.concat(t,'"]'));if(r){const e=r.getBoundingClientRect();await i.showMoneyEffect(a,e.left,e.top)}o.play("money")}await this.checkGameOver()},async drawChanceCard(e){const t=this.settings.chanceCards.filter((e=>!e.used));t.reduce(((e,t)=>e+(t.probability||0)),0),o.play("chance"),await new Promise((e=>setTimeout(e,500)));const a=100*Math.random();let n=0,s=null;for(const i of t)if(n+=i.probability||0,a<=n){s=i;break}if(!s)return this.dialogContent={title:"机会卡",message:"无事发生鸭~",type:"info"},this.showDialog=!0,await new Promise((e=>setTimeout(e,1500))),void this.closeDialog();if(s.oneTime){const e=this.settings.chanceCards.find((e=>e.effect===s.effect));e&&(e.used=!0)}this.dialogContent={title:"机会卡",message:s.effect+(s.amount?"：".concat(s.amount>0?"+":"","$").concat(s.amount):""),type:s.type},this.showDialog=!0,await new Promise((e=>setTimeout(e,1500))),s.amount&&(e.money+=s.amount);const r=document.querySelector('[data-player-id="'.concat(e.id,'"]'));if(r){const e=r.getBoundingClientRect();s.amount&&(await i.showMoneyEffect(s.amount,e.left,e.top),o.play(s.amount>0?"money":"tax")),await i.showParticles(e.left+e.width/2,e.top+e.height/2,"chance")}this.closeDialog()},showMessage(e,t,a){this.dialogContent={title:e,message:t,type:a},this.showDialog=!0},closeDialog(){this.showDialog=!1,this.dialogContent=null},nextPlayer(){this.currentPlayer=(this.currentPlayer+1)%this.players.length},getPositionCoordinates(e){const t=this.cells.length;return e<9?{row:0,col:e}:e<16?{row:e-9+1,col:8}:e<25?{row:8,col:24-e}:{row:t-e,col:0}},needsCornerPath:(e,t)=>0===e.row&&8===t.col||8===e.col&&8===t.row||8===e.row&&0===t.col||0===e.col&&0===t.row,getCornerPath:(e,t)=>0===e.row&&8===t.col?[8]:8===e.col&&8===t.row?[16]:8===e.row&&0===t.col?[24]:0===e.col&&0===t.row?[0]:[],async checkGameOver(){const e=this.players.find((e=>e.money<=0));if(e){const t=[...this.players].sort(((e,t)=>t.money-e.money))[0];this.winner=t,this.isGameOver=!0,o.pauseBGM(),o.play("lose"),await new Promise((e=>setTimeout(e,500))),o.play("win"),await this.playGameOverAnimation(t,e),this.showGameOverDialog(t,e)}},async playGameOverAnimation(e,t){const a=this.players.map((e=>document.querySelector('[data-player-id="'.concat(e.id,'"]')))),n=a[e.id];if(n){n.animate([{transform:"scale(1) rotate(0deg)",filter:"brightness(1)"},{transform:"scale(1.5) rotate(360deg)",filter:"brightness(1.5)"}],{duration:1e3,easing:"cubic-bezier(0.4, 0, 0.2, 1)",fill:"forwards"});const e=n.getBoundingClientRect();await i.showParticles(e.left+e.width/2,e.top+e.height/2,"birthday")}const o=a[t.id];o&&o.animate([{transform:"scale(1) rotate(0deg)",opacity:1},{transform:"scale(0) rotate(-180deg)",opacity:0}],{duration:800,easing:"cubic-bezier(0.4, 0, 0.2, 1)",fill:"forwards"}),a.forEach(((a,n)=>{n!==e.id&&n!==t.id&&a&&a.animate([{transform:"scale(1)",opacity:1},{transform:"scale(0.8)",opacity:.6}],{duration:500,easing:"cubic-bezier(0.4, 0, 0.2, 1)",fill:"forwards"})})),await new Promise((e=>setTimeout(e,1500)))},showGameOverDialog(e,t){this.dialogContent={title:"游戏结束！",message:"".concat(t.name," 破产了！\n").concat(e.name," 以 $").concat(e.money.toLocaleString()," 的资产获得胜利！"),type:"success",action:()=>{this.isGameStarted=!1,this.isGameOver=!1,this.winner=null,this.players=[],this.currentPlayer=0,this.cells.forEach((e=>{"property"===e.type&&delete e.owner}))},props:{style:{position:"fixed",top:"20px",left:"50%",transform:"translateX(-50%)",zIndex:2e3}}},this.showDialog=!0},updateSettings(e){this.settings={...e},localStorage.setItem("gameSettings",JSON.stringify(e)),this.cells=this.generateCells(e),this.isGameStarted&&this.players.forEach((t=>{t.money=e.initialMoney}))},generateCells(e){const t=[];let a=0;const n=["东大街","西大街","南大街","北大街","和平路","青年路","解放路","中山路","人民路","文化街","科技路","商业街","金融街","未来路","创新路","成功路","幸福路","希望街","阳光路","彩虹街","星光路","月亮街","银河路","梦想街","自由路","欢乐街","友谊路","和谐街","繁华路","富贵街","吉祥路","如意街"].sort((()=>Math.random()-.5));let i=0;t.push({id:a++,type:"start",name:"起点",effect:"经过或停留获得".concat(e.startBonus)});const o=32-e.cellCounts.start,s=Math.floor(o/e.cellCounts.property),r=Math.floor(o/e.cellCounts.chance),c=Math.floor(o/e.cellCounts.birthday),l=Math.floor(o/e.cellCounts.tax);for(let p=1;p<32;p++){let o;if(p%s==0&&t.filter((e=>"property"===e.type)).length<e.cellCounts.property){const s=Math.floor(e.propertyMinPrice+(e.propertyMaxPrice-e.propertyMinPrice)*(t.filter((e=>"property"===e.type)).length/e.cellCounts.property));o={id:a++,type:"property",name:n[i++],price:s}}else if(p%r==0&&t.filter((e=>"chance"===e.type)).length<e.cellCounts.chance)o={id:a++,type:"chance",name:"机会",effect:"抽取机会卡片"};else if(p%c==0&&t.filter((e=>"birthday"===e.type)).length<e.cellCounts.birthday)o={id:a++,type:"birthday",name:"生日惊喜",effect:"获得礼金".concat(e.birthdayBonus)};else if(p%l==0&&t.filter((e=>"tax"===e.type)).length<e.cellCounts.tax)o={id:a++,type:"tax",name:"税收",effect:"支付税金".concat(e.taxAmount)};else{const s=Math.floor(e.propertyMinPrice+(e.propertyMaxPrice-e.propertyMinPrice)*(t.filter((e=>"property"===e.type)).length/e.cellCounts.property));o={id:a++,type:"property",name:n[i++],price:s}}t.push(o)}return t}},getters:{currentPlayerData:e=>e.players[e.currentPlayer],isCurrentPlayersTurn:e=>!!e.isGameStarted&&(!e.isGameOver&&!e.isMoving)}});export{o as s,s as u};
